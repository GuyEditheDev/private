{"main":"IyBjb2Rpbmc6IHV0Zi04CmltcG9ydCByZQppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBiYXNlNjQKaW1wb3J0IHdpbjMyY3J5cHQKZnJvbSBDcnlwdG8uQ2lwaGVyIGltcG9ydCBBRVMKaW1wb3J0IHNodXRpbAppbXBvcnQgc3FsaXRlMwpmcm9tIGRob29rcyBpbXBvcnQgV2ViaG9vaywgRmlsZQpmcm9tIFBJTCBpbXBvcnQgSW1hZ2VHcmFiCgpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKcm9hbWluZyA9IG9zLmdldGVudignQVBQREFUQScpCnRlbXAgPSBvcy5nZXRlbnYoJ1RFTVAnKQoKCnVybF93ZWJob29rID0gJ2h0dHBzOi8vZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzLzgzMTgyNzQyMjgwNjU0MDMwOC85eWI3V1VSV3BCdVdBMkpkc0UtYW9wRUx5OFhCRkpLNnpHX0pXbzZVbVMxU0RCTDFZa1RuWjlUQ3JEZXprb1J2ZjlFSicKZGVmIGdldF9tYXN0ZXJfa2V5KHBhdGhfc3RhdGUpOgogICAgd2l0aCBvcGVuKHBhdGhfc3RhdGUsICJyIiwgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICBsb2NhbF9zdGF0ZSA9IGYucmVhZCgpCiAgICAgICAgbG9jYWxfc3RhdGUgPSBqc29uLmxvYWRzKGxvY2FsX3N0YXRlKQogICAgbWFzdGVyX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkKICAgIG1hc3Rlcl9rZXkgPSBtYXN0ZXJfa2V5WzU6XQogICAgbWFzdGVyX2tleSA9IHdpbjMyY3J5cHQuQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICByZXR1cm4gbWFzdGVyX2tleQoKCmRlZiBkZWNyeXB0X3BheWxvYWQoY2lwaGVyLCBwYXlsb2FkKToKICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQoKCmRlZiBnZW5lcmF0ZV9jaXBoZXIoYWVzX2tleSwgaXYpOgogICAgcmV0dXJuIEFFUy5uZXcoYWVzX2tleSwgQUVTLk1PREVfR0NNLCBpdikKCmRlZiBkZWNyeXB0X3Bhc3N3b3JkKGJ1ZmYsIG1hc3Rlcl9rZXkpOgogICAgdHJ5OgogICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICBjaXBoZXIgPSBnZW5lcmF0ZV9jaXBoZXIobWFzdGVyX2tleSwgaXYpCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0X3BheWxvYWQoY2lwaGVyLCBwYXlsb2FkKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gIkNocm9tZSA8IDgwIgoKcGF0aHNfc3RhdGUgPSB7CiAgICAnR29vZ2xlIENocm9tZSc6IGxvY2FsICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcTG9jYWwgU3RhdGUnCn0KCmZvciBwbGF0Zm9ybV9sb2wsIHBhdGhfbG9sIGluIHBhdGhzX3N0YXRlLml0ZW1zKCk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aF9sb2wpOgogICAgICAgIGNvbnRpbnVlCiAgICBtYXN0ZXJfa2V5ID0gZ2V0X21hc3Rlcl9rZXkocGF0aF9sb2wpCgpwYXRoc19jaHJvbWUgPSB7CiAgICAnR29vZ2xlIENocm9tZSc6IGxvY2FsICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTInOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMVxcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTMnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMlxcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTQnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTUnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNFxcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTYnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNVxcTG9naW4gRGF0YScsCiAgICAnR29vZ2xlIENocm9tZTcnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNlxcTG9naW4gRGF0YScKICAgIH0KCmZvciBwbGF0Zm9ybV9sb2wsIHBhdGhfbWRyIGluIHBhdGhzX2Nocm9tZS5pdGVtcygpOgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGhfbWRyKToKICAgICAgICBjb250aW51ZQogICAgc2h1dGlsLmNvcHkyKHBhdGhfbWRyLCB0ZW1wICsgIkxvZ2ludmF1bHQuZGIiKQogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCh0ZW1wICArICJMb2dpbnZhdWx0LmRiIikKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKCgogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKQogICAgZmlsZV9ncmFiID0gb3Blbihsb2NhbCArICdcXEdvb2dsZVxcUGFzc3dvcmRfQ2hyb21lLnR4dCcsICd3JykKICAgIGZvciByIGluIGN1cnNvci5mZXRjaGFsbCgpOgogICAgICAgIHVybCA9IHJbMF0KICAgICAgICB1c2VybmFtZSA9IHJbMV0KICAgICAgICBlbmNyeXB0ZWRfcGFzc3dvcmQgPSByWzJdCiAgICAgICAgZGVjcnlwdGVkX3Bhc3N3b3JkID0gZGVjcnlwdF9wYXNzd29yZChlbmNyeXB0ZWRfcGFzc3dvcmQsIG1hc3Rlcl9rZXkpCiAgICAgICAgZmlsZV9ncmFiLndyaXRlKGYiVVJMOiB7dXJsfVxuVXNlciBOYW1lOiB7dXNlcm5hbWV9XG5QYXNzd29yZDoge2RlY3J5cHRlZF9wYXNzd29yZH0iICsgIlxuIiArICIqIiAqIDUwICsgIlxuIikKICAgIGZpbGVfZ3JhYi5jbG9zZSgpCgogICAgY3Vyc29yLmNsb3NlKCkKICAgIGNvbm4uY2xvc2UoKQogICAgdHJ5OgogICAgICAgIG9zLnJlbW92ZSh0ZW1wICsgIkxvZ2ludmF1bHQuZGIiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHBhc3MKCnBhdGhzID0gewogICAgJ0Rpc2NvcmQnOiByb2FtaW5nICsgJ1xcRGlzY29yZFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnRGlzY29yZCBDYW5hcnknOiByb2FtaW5nICsgJ1xcZGlzY29yZGNhbmFyeVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnRGlzY29yZCBQVEInOiByb2FtaW5nICsgJ1xcZGlzY29yZHB0YlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZSc6IGxvY2FsICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTInOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTMnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTQnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTUnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTYnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnR29vZ2xlIENocm9tZTcnOiBsb2NhbCArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnT3BlcmEnOiByb2FtaW5nICsgJ1xcT3BlcmEgU29mdHdhcmVcXE9wZXJhIFN0YWJsZVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmUnOiBsb2NhbCArICdcXEJyYXZlU29mdHdhcmVcXEJyYXZlLUJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmUxJzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgMVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmUyJzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgMlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmUzJzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmU0JzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmU1JzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnQnJhdmU2JzogbG9jYWwgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4JzogbG9jYWwgKyAnXFxZYW5kZXhcXFlhbmRleEJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4MSc6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgMVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4Mic6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgMlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4Myc6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4NCc6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4NSc6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicsCiAgICAnWWFuZGV4Nic6IGxvY2FsICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXFByb2ZpbGUgNlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicKfQoKCmRlZiBmaW5kX3Rva2VuKHBhdGgpOgogICAgdG9rZW5zID0gW10KCiAgICBmb3IgZmlsZV9uYW1lIGluIG9zLmxpc3RkaXIocGF0aCk6CiAgICAgICAgaWYgbm90IGZpbGVfbmFtZS5lbmRzd2l0aCgnLmxvZycpIGFuZCBub3QgZmlsZV9uYW1lLmVuZHN3aXRoKCcubGRiJyk6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmJ3twYXRofVxce2ZpbGVfbmFtZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgIGZvciByZWdleCBpbiAocidbXHctXXsyNH1cLltcdy1dezZ9XC5bXHctXXsyN30nLCByJ21mYVwuW1x3LV17ODR9Jyk6CiAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChyZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgICAgICAgICBsaXN0X3Rva2Vucy5hcHBlbmQodG9rZW4pCiAgICAKICAgIHJldHVybiB0b2tlbnMKCmxpc3RfdG9rZW5zID0gW10KZGVmIGdyYWJfYWxsKHRva2VuKToKICAgIHRva2VuaW5mbyA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjgvdXNlcnMvQG1lJywgaGVhZGVycz17J2F1dGhvcml6YXRpb24nOiB0b2tlbn0pLmpzb24oKQogICAgciA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjgvdXNlcnMvQG1lJywgaGVhZGVycz17J2F1dGhvcml6YXRpb24nOiB0b2tlbn0pCiAgICBpZiByLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICByZXR1cm4KICAgIGlwaW5mbyA9IHJlcXVlc3RzLmdldCgnaHR0cDovL2lwLWFwaS5jb20vanNvbi8nKS5qc29uKCkKICAgIG5pdHJvX3R5cGUgPSBqc29uLmxvYWRzKHIuY29udGVudCkKICAgIHRyeToKICAgICAgICBuaXRyb190eXBlWydwcmVtaXVtX3R5cGUnXQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBkbml0cm8gPSAiTm9uIgogICAgZWxzZToKICAgICAgICBpZiBuaXRyb190eXBlWydwcmVtaXVtX3R5cGUnXSA9PSAxOgogICAgICAgICAgICBkbml0cm8gPSAiTml0cm8gQ2xhc3NpYyIKICAgICAgICBlbGlmIG5pdHJvX3R5cGVbJ3ByZW1pdW1fdHlwZSddID09IDI6CiAgICAgICAgICAgIGRuaXRybyA9ICJOaXRybyBCb29zdCIKICAgIHBheWxvYWQgPSB7CiAgICAgICAgImVtYmVkcyI6IFt7CiAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3Rva2VuaW5mb1sndXNlcm5hbWUnXX0je3Rva2VuaW5mb1snZGlzY3JpbWluYXRvciddfSIsCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiBmImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMve3Rva2VuaW5mb1snaWQnXX0ve3Rva2VuaW5mb1snYXZhdGFyJ119LmpwZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZpZWxkcyI6IFt7CiAgICAgICAgICAgICAgICAibmFtZSI6ICIqKkluZm9zIERpc2NvcmQqKiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiBmIklEOiB7dG9rZW5pbmZvWydpZCddfVxuRW1haWw6IHt0b2tlbmluZm9bJ2VtYWlsJ119XG5OdW3pcm8gZGUgdOls6XBob25lOiB7dG9rZW5pbmZvWydwaG9uZSddfVxuTml0cm86IHtkbml0cm99XG5Ub2tlbjoge3Rva2VufSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICIqKkF1dHJlcyBpbmZvcyoqIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYiTm9tIGR1IFBDOiB7b3MuZ2V0ZW52KCdDT01QVVRFUk5BTUUnKX1cbk5vbSBkZSBzZXNzaW9uOiB7b3MuZ2V0bG9naW4oKX1cbklQOiB7aXBpbmZvWydxdWVyeSddfSIKICAgICAgICAgICAgfV0KICAgICAgICB9XQogICAgfQogICAgcmVxdWVzdHMucG9zdCh1cmxfd2ViaG9vaywganNvbj1wYXlsb2FkKQogICAgaG9vayA9IFdlYmhvb2sodXJsX3dlYmhvb2spCiAgICBzY3JlZW4gPSBJbWFnZUdyYWIuZ3JhYigpCiAgICBzY3JlZW4uc2F2ZShsb2NhbCArICdcXHNjcmVlbi5wbmcnKQogICAgc2NyZWVuLmNsb3NlKCkKICAgIGhvb2suc2VuZChmaWxlPUZpbGUobG9jYWwgKyAiXFxzY3JlZW4ucG5nIikpCiAgICBvcy5yZW1vdmUobG9jYWwgKyAnXFxzY3JlZW4ucG5nJykKICAgIHdpdGggb3Blbihsb2NhbCArICdcXEdvb2dsZVxcUGFzc3dvcmRfQ2hyb21lLnR4dCcsICdyJykgYXMgZnA6CiAgICAgICAgaG9vay5zZW5kKGZpbGU9RmlsZShmcCwgbmFtZT1mIlBhc3N3b3Jkc19DaHJvbWVfe3Rva2VuaW5mb1sndXNlcm5hbWUnXX0udHh0IikpCgpmb3IgcGxhdGZvcm1fbG9sLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgY29udGludWUKCiAgICB0b2tlbnMgPSBmaW5kX3Rva2VuKHBhdGgpCiAgICBpZiBsZW4odG9rZW5zKSA+IDA6CiAgICAgICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICAgICAgZ3JhYl9hbGwodG9rZW4p'}
